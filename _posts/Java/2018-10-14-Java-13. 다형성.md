---
title: "[Java]13. 다형성(Polymorphism)"
excerpt: "Java 객체지향프로그래밍"
search: true
categories:
  - Study
tags:
  - Study_Java
toc: true
sidebar_main: true
---

# 13. 다형성(Polymorphism)

## 다형성의 정의
- 객체지향개념에서 다형성이란 '여러 가지 형태를 가질 수 있는 능력'이다.
	- 자바에서는 한 타입의 참조변수로 여러 타입의 객체를 참조할 수 있도록 하여 다형성을 구현하였다.
- 조상클래스 타입의 참조변수로 자손클래스의 인스턴스를 참조할 수 있다.
	- 참조변수가 사용할 수 있는 멤버의 개수는 인스턴스의 멤버 개수보다 항상 같거나 적어야 한다.
	- 위의 이유 때문에, 자손타입의 참조변수로 조상타입의 인스턴스는 참조할 수 없다.
- 예제

___예제 코드___

```java
class Tv {
	boolean power;
	int channel;

	void power() { power != power; }
	void channelUp() { ++channel; }
	void channelDown() { --channel; }
}

class CaptionTv extends Tv {
	String text;
	void caption() { ... }
}
```

- 위의 코드를 바탕으로, 다형성에 의해 아래와 같은 초기화가 가능하다.

```java
CaptionTv c = new CaptionTv();
Tv t = new CaptionTv();
```

- 하지만, Tv타입의 참조변수로 CaptionTv인스턴스를 생성한 변수 t는 Tv클래스에 정의되지 않은 멤버인 text와 caption()은 사용할 수 없다.
	- **같은 타입의 인스턴스라도 참조변수의 타입에 따라 사용할 수 있는 멤버의 개수가 달라진다.**

## 참조변수의 형변환
- 참조변수는 서로 **상속관계** 에 있는 클래스 사이에서만 서로 형변환이 가능하다.
	- 조상의 조상으로도 형변환이 가능하기 때문에, 상속관계에만 있다면 서로 형변환이 가능하다.
	- 클래스 A, B, C가 있을 때, A <- C, A <- B의 상속관계가 있다고 가정하자. 이 때, B, C는 서로 형변환이 불가능하다.(B,C는 서로 아무 관계가 없음)
- 기본형 변수 형변환과 유사하다.
	- 작은 자료형에서 큰 자료형의 형변환이 생략이 가능하듯이, 자손타입의 참조변수를 조상타입의 참조변수로 형변환활 경우에는 생략이 가능하다.
	- 참조변수의 형변환에도 캐스트연산자 '()'를 사용한다.
- 자손타입 -> 조상타입 (Up-casting): 형변환 생략가능
- 자손타입 <- 조상타입 (Down-casting): 형변환 생략불가
- 참조변수의 형변환은 인스턴스에 아무런 영향을 미치지 않는다.
- 참조변수의 형변환을 통해서 참조하고 있는 인스턴스에서 사용할 수 있는 멤버의 범위(개수)를 조절할 수 있다.
- 주의할 예제

___예제 코드___

```java
class CastingTest {
	public static void main(String args[]) {
		Car car = new Car();
		Car Car2 = null;
		FireEngine fe = null;

		car.drive();
		fe = (FireEngine)car;  // 8번째 줄, 컴파일은 가능하지만 실행 시 에러가 발생한다.
		fe.drive();
		car2 = fe;
		car2.drive();
	}
}
```

___실행 결과___

```
drive, ...
java.lang.ClassCastException: Car at CastingTest.main(CastingTest.java:8)
```

- 컴파일 시에는 참조변수간의 타입만 체크하고 인스턴스의 타입에 대해서는 알지 못하므로, 컴파일 시에는 에러가 발생하지 않는다.
- 참조변수가 참조하고 있는 인스턴스의 자손타입으로 형변환하는 것은 허용되지 않는다.
	- ```Car car = new Car();``` -> ```Car car = new FireEngine();```으로 변경하면 실행 가능하다.

## instanceof 연산자
- instanceof 연산자는 참조변수가 참조하고 있는 인스턴스의 실제 타입을 알아보기 위해 사용한다.
- 형태는 ```참조변수 incstanceof 타입(클래스명)```이며, 반환값은 true, false이다.
	- true: 참조변수가 검사한 타입으로 형변환이 가능하다는 의미이다.
	- 값이 null인 참조변수는 항상 false를 반환한다.

### 참조변수와 인스턴스의 연결
- 조상타입의 참조변수로 자손 인스턴스를 참조하는 경우와 자손타입의 참조변수로 자손 인스턴스를 참조하는 경우는 다른 결과를 얻는다.
	- 메서드의 경우는 참조변수의 타입에 관계없이 오버라이딩에 따라 다르게 호출된다. (인스턴스 메서드)
		- static 메서드는 참조변수의 타입에 영향을 받기 때문에, 반드시 '클래스이름.메서드()'로 호출해야한다.
	- 멤버변수의 경우 참조변수의 타입에 따라 달라진다.
		- 멤버변수가 조상과 자손클래스에 중복 정의된 경우, 조상타입의 참조변수를 사용했을 때는 조상 클래스에 선언된 멤버변수가 사용되고, 자손타입의 참조변수를 사용했을 때는 자손 클래스에 선언된 멤버변수가 사용된다.

## 매개변수의 다형성
- 메서드의 매개변수에도 다형성은 적용된다.
- 예제

___예제 코드___

```java
class Product {
	int price;        // 제품 가격
	int bonusPoint;   // 제품구매시 제공하는 보너스 점수
}
class Tv extends Product {}
class Computer extends Product {}
class Audio extends Product {}

class Buyer {                 // 고객
	int money = 1000;     // 소유금액
	int bonusPoint = 0;   // 보너스 점수
}
```

- 물건을 구입하는 메서드
1. 다형성 적용하기 전

```java
void buy(Tv t) { ... }
void buy(Computer c) { ... }
void buy(Audio a) { ... }
```

2.  다형성 적용

```java
void buy(Product p) { ... }
```

## 여러 종류의 객체를 배열로 다루기
- 참조변수를 배열로 처리할 수 있다.
- 예제
1. 배열 사용하기 전

```java
Product p1 = new Tv();
Product p2 = new Computer();
Product p3 = new Audio();
```

2. 배열

```java
Product p[] = new Product[3];
p[0] = new Tv();
p[1] = new Computer();
p[2] = new Audio();
```

- 동적 크기 배열인 Vector 클래스 역시 사용가능하다.
- Vector 클래스의 주요 메서드

| 메서드 / 생성자          |                                                        설 명                                                        |
|--------------------------|:-------------------------------------------------------------------------------------------------------------------:|
| Vector()                 | 10개의 객체를 저장할 수 있는 Vector인스턴스를 생성한다. 10개이상의 인스턴스가 저장되면, 자동적으로 크기가 증가한다. |
| boolean add(Object o)    |                      Vector에 객체를 추가한다. 추가에 성공하면 true, 실패하면 false를 반환한다.                     |
| boolean remove(Object o) |               Vector에 저장되어 있는 객체를 제거한다. 제거에 성공하면 true, 실패하면 false를 반환한다.              |
| boolean isEmpty()        |                   Vector가 비어있는지 검사한다. 비어있으면 true, 비어있지 않으면 false를 반환한다.                  |
| Object get(int index)    |        지정된 위치(index)의 객체를 반환한다. 반환타입이 Object타입이므로 적절한 타입으로의 형변환이 필요하다.       |
| int size()               |                                       Vector에 저장된 객체의 개수를 반환한다.                                       |
