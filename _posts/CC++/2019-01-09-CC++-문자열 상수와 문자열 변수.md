---
title: "[C/C++]문자열 상수와 문자열 변수"
excerpt: "C/C++ 에서 문자열을 사용할 때 알아야할 내용"
categories:
  - Language
tags:
  - Language_CCpp
search: true
toc: true
sidebar_main: true
---

C/C++ 에서 문자열을 특히 ```char``` 형으로 다룰 때 문자열 상수와 문자열 변수를 구분해서 사용해야 한다. 그렇지 않으면 수 많은 에러때문에 고생할 수 있다.

먼저, C/C++ 의 메모리 구조를 보자.

![c memory structure](https://user-images.githubusercontent.com/34755287/50886161-17ff3680-1433-11e9-992f-a29ac316482d.JPG)

메모리는 총 3가지로 구분되고, 위와 같이 구성되어 있다. 데이터 영역에서 코드 영역과 나누어 구분하기도 한다.

이제 문자열 상수와 문자열 변수의 예제를 보자.

```cpp
char *c = "apple";      //문자열 상수
char v[10] = "apple";    //문자열 변수
```

문자열 상수는 포인터 변수를 선언하여 문자열을 대입하고, 문자열 변수는 배열을 선언하여 대입한다. 여기서 각각 메모리를 차지하는 영역을 보자.

![default](https://user-images.githubusercontent.com/34755287/50886162-1897cd00-1433-11e9-9753-0ca7c63c24a8.JPG)

그림에서 보듯이, 문자열 상수에서 문자열은 데이터 영역이고, 문자열 변수는 스택 영역에 위치해 있다. 이름에서도 알 수 있듯이, 문자열 상수는 읽기만 가능하고 바꿀 수는 없다. 문자열을 바꾸기 위해서는 새로운 문자열 주소를 할당해야 한다. 즉, 포인터 변수가 바뀐다. 반면에, 문자열 변수는 읽고, 쓰기가 가능하다. 문자열을 바꿀려면 해당 인덱스에 접근하여 바꿀 수 있다. 하지만 위와 같은 배열 선언은 포인터 상수이다. 즉, 포인터는 바뀔 수 없다. 그렇다면, 문자열 상수와 변수의 데이터가 "apple" 에서 "banana"로 변경하려면 어떻게 해야 할까?

- 문자열 상수

```cpp
char *c = "apple";
c = "banana";             // banana
//strcpy(c, "banana");    // Runtime Error!
```

- 문자열 변수

```cpp
char v[10] = "apple";
//v = "banana";           // syntax error!
strcpy(v, "banana");      // banana
```

위의 코드와 같이 수행해야 한다. 위에서 설명하였듯이, 문자열 상수는 "banana" 라는 새로운 문자열 주소를 가르키게 하였고, 문자열 변수는 인덱스에 접근하여 하나 하나 변경해주었다. ```strcpy``` 함수를 잠깐 보자면 간단하게 아래와 같이 구현되어 있다.

```cpp
char *strcpy(char *dest, const char *src)
{
	char *cp = dest;
	while (*(cp++) = *(src++))
		;
	return dest;
}
```

그리고, 서로 반대로 변경할려고 하면 에러가 발생한다. 이렇게 바뀐 모습을 그림으로 보면 아래와 같다.

![2](https://user-images.githubusercontent.com/34755287/50886163-1897cd00-1433-11e9-85d5-9a269b1924c5.JPG)

문자열 상수와 변수의 특징을 정리하면 다음과 같다.
- 문자열 상수
  - 실제 문자열은 데이터 영역에 저장된다.
  - 읽기만 가능하다.(배열 인덱스로 접근하여 읽을 수는 있지만, 값은 변경할 수 없다.)
  - 문자열을 변경하려면 포인터를 바꿔주어야 한다.(포인터 변수)
- 문자열 변수
  - 실제 문자열은 스택 영역에 저장된다.
  - 배열 인덱스로 접근하여 읽고 쓰기가 가능하다.
  - 문자열을 변경하려면 배열 인덱스 하나 하나에 접근하여 바꿔준다.(포인터 상수)

### 동적 할당에서 문자열
동적 할당에서는 문자열을 상수로 초기화하면 문자열 상수처럼 사용해야 하고, 변수로 선언하면 문자열 변수처럼 사용해야 한다. 아래에도 잠깐 살펴보겠지만 동적 할당을 제대로 사용하는 것은 문자열 변수로 사용하는 것이다. 다음과 같은 예제를 보자.

```cpp
//초기화 1 문자열 상수
char *str1 = new char[10];
str1 = "apple";
str1 = "banana";             // banana
//strcpy(str1, "banana");    // Runtime Error!

//초기화 2 문자열 변수
char *str2 = new char[10];
strcpy(str2, "apple");
//str2 = "banana";           // Runtime error!
strcpy(str2, "banana");      // banana
```

하지만 동적 할당을 문자열 상수로 사용하면 메모리 해제 문제가 발생하는 것으로 보인다. 생각해보면 당연한 것 같다. 위의 예제서도 보이듯이 동적으로 10개의 char 형을 할당받았는데 문자열 상수를 사용하면 할당받은 메모리를 사용하는 것이 아니라 선언된 포인터 변수만을 사용하는 것이 된다.
